<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Don't rewrite files or directories
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # ========================================
  # OPEN GRAPH - SOCIAL MEDIA CRAWLERS
  # ========================================
  # Detect social media crawlers and serve Open Graph HTML
  # via Supabase Edge Function instead of React SPA

  # Match /share/{job_id} requests from crawlers
  RewriteCond %{REQUEST_URI} ^/share/([a-zA-Z0-9\-]+)$ [NC]
  RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit|Facebot|LinkedInBot|Twitterbot|WhatsApp|TelegramBot|Discordbot|Slackbot|Pinterest|SkypeUriPreview|vkShare) [NC,OR]
  RewriteCond %{HTTP_USER_AGENT} (tumblr|flipboard|nuzzel|redditbot|Embedly|quora|outbrain|ia_archiver) [NC]
  RewriteRule ^share/([a-zA-Z0-9\-]+)$ https://hhhjzgeidjqctuveopso.supabase.co/functions/v1/social-gateway/$1 [P,L]

  # For human users: serve React SPA normally
  RewriteRule ^ index.html [L]
</IfModule>

# Gzip compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
</IfModule>
