<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Export Candidatures</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0E2F56;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #0E2F56;
        }
        .test-section h2 {
            margin-top: 0;
            color: #0E2F56;
        }
        button {
            background: #0E2F56;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #1a4275;
        }
        button.secondary {
            background: #16a34a;
        }
        button.secondary:hover {
            background: #15803d;
        }
        .info-box {
            background: #e0f2fe;
            border: 1px solid #0284c7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .info-box strong {
            color: #0369a1;
        }
        .sample-data {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        .sample-data h3 {
            margin-top: 0;
            color: #374151;
        }
        .candidate-item {
            padding: 10px;
            margin: 5px 0;
            background: #f3f4f6;
            border-radius: 4px;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-strong {
            background: #dcfce7;
            color: #166534;
        }
        .badge-medium {
            background: #fef9c3;
            color: #854d0e;
        }
        .badge-weak {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Export de Candidatures</h1>
        <p class="subtitle">Testez le syst√®me d'export complet avec des donn√©es de d√©monstration</p>

        <div class="info-box">
            <strong>‚ÑπÔ∏è Information:</strong> Ce test simule l'export de candidatures avec des fichiers PDF de d√©monstration.
            L'archive ZIP contiendra une liste Excel et les documents organis√©s par cat√©gorie.
        </p>

        <div class="test-section">
            <h2>üì¶ Export Premium (3 cat√©gories)</h2>
            <p>Simule un recruteur PREMIUM avec tri IA en 3 cat√©gories</p>
            <button onclick="testPremiumExport()">T√©l√©charger Export Premium</button>
            <div class="sample-data">
                <h3>Donn√©es de test incluses:</h3>
                <div class="candidate-item">
                    <strong>Jean Dupont</strong> <span class="badge badge-strong">Fort (85%)</span><br>
                    CV: CV_Jean_Dupont.pdf | Lettre: Lettre_Jean_Dupont.pdf
                </div>
                <div class="candidate-item">
                    <strong>Marie Martin</strong> <span class="badge badge-strong">Fort (78%)</span><br>
                    CV: CV_Marie_Martin.pdf | Lettre: Lettre_Marie_Martin.pdf
                </div>
                <div class="candidate-item">
                    <strong>Pierre Bernard</strong> <span class="badge badge-medium">Moyen (62%)</span><br>
                    CV: CV_Pierre_Bernard.pdf | Lettre: Lettre_Pierre_Bernard.pdf
                </div>
                <div class="candidate-item">
                    <strong>Sophie Dubois</strong> <span class="badge badge-weak">Faible (45%)</span><br>
                    CV: CV_Sophie_Dubois.pdf | Lettre: Lettre_Sophie_Dubois.pdf
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìÑ Export Standard (1 cat√©gorie)</h2>
            <p>Simule un recruteur NON-PREMIUM sans tri IA</p>
            <button class="secondary" onclick="testStandardExport()">T√©l√©charger Export Standard</button>
            <div class="sample-data">
                <h3>Donn√©es de test incluses:</h3>
                <p>Les 4 m√™mes candidatures, mais dans un seul dossier "Candidatures"</p>
            </div>
        </div>

        <div id="status" style="margin-top: 30px; padding: 15px; border-radius: 8px; display: none;"></div>
    </div>

    <script>
        // Cr√©er un PDF de d√©monstration
        function createDemoPDF(name, type) {
            const content = `%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /Resources << /Font << /F1 << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> >> >> /MediaBox [0 0 612 792] /Contents 4 0 R >>
endobj
4 0 obj
<< /Length 100 >>
stream
BT
/F1 24 Tf
100 700 Td
(${type} - ${name}) Tj
ET
endstream
endobj
xref
0 5
0000000000 65535 f
0000000009 00000 n
0000000058 00000 n
0000000115 00000 n
0000000314 00000 n
trailer
<< /Size 5 /Root 1 0 R >>
startxref
464
%%EOF`;
            return new Blob([content], { type: 'application/pdf' });
        }

        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.style.background = type === 'success' ? '#dcfce7' : type === 'error' ? '#fee2e2' : '#e0f2fe';
            status.style.border = type === 'success' ? '1px solid #16a34a' : type === 'error' ? '1px solid #dc2626' : '1px solid #0284c7';
            status.style.color = type === 'success' ? '#166534' : type === 'error' ? '#991b1b' : '#0369a1';
            status.innerHTML = message;
        }

        async function testPremiumExport() {
            showStatus('‚è≥ Cr√©ation de l\'archive Premium...', 'info');

            try {
                const zip = new JSZip();
                const timestamp = new Date().toISOString().split('T')[0];

                // Cr√©er le fichier Excel de liste
                const excelContent = createExcelList(true);
                zip.file('liste_candidatures_Developpeur_Fullstack.xls', excelContent);

                // Profils Forts
                const fortsFolder = zip.folder('Profils_Forts');
                const jean = fortsFolder.folder('Jean_Dupont');
                jean.file('CV_Jean_Dupont.pdf', createDemoPDF('Jean Dupont', 'CV'));
                jean.file('Lettre_motivation_Jean_Dupont.pdf', createDemoPDF('Jean Dupont', 'Lettre de motivation'));

                const marie = fortsFolder.folder('Marie_Martin');
                marie.file('CV_Marie_Martin.pdf', createDemoPDF('Marie Martin', 'CV'));
                marie.file('Lettre_motivation_Marie_Martin.pdf', createDemoPDF('Marie Martin', 'Lettre de motivation'));

                // Profils Moyens
                const moyensFolder = zip.folder('Profils_Moyens');
                const pierre = moyensFolder.folder('Pierre_Bernard');
                pierre.file('CV_Pierre_Bernard.pdf', createDemoPDF('Pierre Bernard', 'CV'));
                pierre.file('Lettre_motivation_Pierre_Bernard.pdf', createDemoPDF('Pierre Bernard', 'Lettre de motivation'));

                // Profils Faibles
                const faiblesFolder = zip.folder('Profils_Faibles');
                const sophie = faiblesFolder.folder('Sophie_Dubois');
                sophie.file('CV_Sophie_Dubois.pdf', createDemoPDF('Sophie Dubois', 'CV'));
                sophie.file('Lettre_motivation_Sophie_Dubois.pdf', createDemoPDF('Sophie Dubois', 'Lettre de motivation'));

                // G√©n√©rer et t√©l√©charger
                const content = await zip.generateAsync({ type: 'blob' });
                const url = window.URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `export_premium_Developpeur_Fullstack_${timestamp}.zip`;
                a.click();
                window.URL.revokeObjectURL(url);

                showStatus('‚úÖ Export Premium cr√©√© avec succ√®s! L\'archive contient 4 candidats r√©partis en 3 cat√©gories + liste Excel.', 'success');
            } catch (error) {
                showStatus('‚ùå Erreur: ' + error.message, 'error');
            }
        }

        async function testStandardExport() {
            showStatus('‚è≥ Cr√©ation de l\'archive Standard...', 'info');

            try {
                const zip = new JSZip();
                const timestamp = new Date().toISOString().split('T')[0];

                // Cr√©er le fichier Excel de liste
                const excelContent = createExcelList(false);
                zip.file('liste_candidatures_Developpeur_Fullstack.xls', excelContent);

                // Tous dans un seul dossier
                const candidaturesFolder = zip.folder('Candidatures');

                const jean = candidaturesFolder.folder('Jean_Dupont');
                jean.file('CV_Jean_Dupont.pdf', createDemoPDF('Jean Dupont', 'CV'));
                jean.file('Lettre_motivation_Jean_Dupont.pdf', createDemoPDF('Jean Dupont', 'Lettre de motivation'));

                const marie = candidaturesFolder.folder('Marie_Martin');
                marie.file('CV_Marie_Martin.pdf', createDemoPDF('Marie Martin', 'CV'));
                marie.file('Lettre_motivation_Marie_Martin.pdf', createDemoPDF('Marie Martin', 'Lettre de motivation'));

                const pierre = candidaturesFolder.folder('Pierre_Bernard');
                pierre.file('CV_Pierre_Bernard.pdf', createDemoPDF('Pierre Bernard', 'CV'));
                pierre.file('Lettre_motivation_Pierre_Bernard.pdf', createDemoPDF('Pierre Bernard', 'Lettre de motivation'));

                const sophie = candidaturesFolder.folder('Sophie_Dubois');
                sophie.file('CV_Sophie_Dubois.pdf', createDemoPDF('Sophie Dubois', 'CV'));
                sophie.file('Lettre_motivation_Sophie_Dubois.pdf', createDemoPDF('Sophie Dubois', 'Lettre de motivation'));

                // G√©n√©rer et t√©l√©charger
                const content = await zip.generateAsync({ type: 'blob' });
                const url = window.URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `export_standard_Developpeur_Fullstack_${timestamp}.zip`;
                a.click();
                window.URL.revokeObjectURL(url);

                showStatus('‚úÖ Export Standard cr√©√© avec succ√®s! L\'archive contient 4 candidats dans 1 seul dossier + liste Excel.', 'success');
            } catch (error) {
                showStatus('‚ùå Erreur: ' + error.message, 'error');
            }
        }

        function createExcelList(isPremium) {
            let html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Candidatures</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body>';

            html += '<table>';
            html += '<tr><td colspan="8" style="background-color: #0E2F56; color: white; font-weight: bold; padding: 16px; font-size: 18px; text-align: center;">D√©veloppeur Fullstack - ' + (isPremium ? 'Export Premium avec tri IA' : 'Export Standard') + '</td></tr>';
            html += '<tr><td colspan="8" style="padding: 8px; text-align: center;">Date: ' + new Date().toLocaleDateString('fr-FR') + ' | Total: 4 candidatures</td></tr>';
            html += '<tr><td colspan="8" style="height: 20px;"></td></tr>';

            if (isPremium) {
                // Profils Forts
                html += '<tr><td colspan="8" style="background-color: #16a34a; color: white; font-weight: bold; padding: 12px;">‚úÖ Profils Forts (2)</td></tr>';
                html += createTableHeaders();
                html += '<tr><td>Jean Dupont</td><td>jean.dupont@email.com</td><td>+33 6 12 34 56 78</td><td>D√©veloppeur Senior</td><td>85%</td><td>Fort</td><td>Entretien</td><td>15/01/2025</td></tr>';
                html += '<tr><td>Marie Martin</td><td>marie.martin@email.com</td><td>+33 6 98 76 54 32</td><td>D√©veloppeur Fullstack</td><td>78%</td><td>Fort</td><td>Re√ßu</td><td>14/01/2025</td></tr>';
                html += '<tr><td colspan="8" style="height: 20px;"></td></tr>';

                // Profils Moyens
                html += '<tr><td colspan="8" style="background-color: #ca8a04; color: white; font-weight: bold; padding: 12px;">‚ö†Ô∏è Profils Moyens (1)</td></tr>';
                html += createTableHeaders();
                html += '<tr><td>Pierre Bernard</td><td>pierre.bernard@email.com</td><td>+33 6 45 67 89 01</td><td>D√©veloppeur Junior</td><td>62%</td><td>Moyen</td><td>Re√ßu</td><td>13/01/2025</td></tr>';
                html += '<tr><td colspan="8" style="height: 20px;"></td></tr>';

                // Profils Faibles
                html += '<tr><td colspan="8" style="background-color: #dc2626; color: white; font-weight: bold; padding: 12px;">‚ùå Profils Faibles (1)</td></tr>';
                html += createTableHeaders();
                html += '<tr><td>Sophie Dubois</td><td>sophie.dubois@email.com</td><td>+33 6 23 45 67 89</td><td>Stagiaire</td><td>45%</td><td>Faible</td><td>Re√ßu</td><td>12/01/2025</td></tr>';
            } else {
                html += createTableHeaders();
                html += '<tr><td>Jean Dupont</td><td>jean.dupont@email.com</td><td>+33 6 12 34 56 78</td><td>D√©veloppeur Senior</td><td>85%</td><td>Fort</td><td>Entretien</td><td>15/01/2025</td></tr>';
                html += '<tr><td>Marie Martin</td><td>marie.martin@email.com</td><td>+33 6 98 76 54 32</td><td>D√©veloppeur Fullstack</td><td>78%</td><td>Fort</td><td>Re√ßu</td><td>14/01/2025</td></tr>';
                html += '<tr><td>Pierre Bernard</td><td>pierre.bernard@email.com</td><td>+33 6 45 67 89 01</td><td>D√©veloppeur Junior</td><td>62%</td><td>Moyen</td><td>Re√ßu</td><td>13/01/2025</td></tr>';
                html += '<tr><td>Sophie Dubois</td><td>sophie.dubois@email.com</td><td>+33 6 23 45 67 89</td><td>Stagiaire</td><td>45%</td><td>Faible</td><td>Re√ßu</td><td>12/01/2025</td></tr>';
            }

            html += '</table></body></html>';
            return html;
        }

        function createTableHeaders() {
            return '<tr style="background-color: #f0f0f0; font-weight: bold;"><th style="padding: 8px; border: 1px solid #ddd;">Candidat</th><th style="padding: 8px; border: 1px solid #ddd;">Email</th><th style="padding: 8px; border: 1px solid #ddd;">T√©l√©phone</th><th style="padding: 8px; border: 1px solid #ddd;">Poste</th><th style="padding: 8px; border: 1px solid #ddd;">Score IA</th><th style="padding: 8px; border: 1px solid #ddd;">Cat√©gorie</th><th style="padding: 8px; border: 1px solid #ddd;">Statut</th><th style="padding: 8px; border: 1px solid #ddd;">Date</th></tr>';
        }
    </script>
</body>
</html>
